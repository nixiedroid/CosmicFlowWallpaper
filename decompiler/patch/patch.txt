diff '--context=1' --strip-trailing-cr -r app/src/main/AndroidManifest.xml new/src/main/AndroidManifest.xml
*** app/src/main/AndroidManifest.xml	Mon May  6 12:39:51 2024
--- new/src/main/AndroidManifest.xml	Mon May  6 12:38:38 2024
***************
*** 1,5 ****
! <?xml version="1.0" encoding="utf-8" standalone="no"?><manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.sonyericsson.cosmicflow">
      <uses-feature android:glEsVersion="0x00020000"/>
!     <application android:debuggable="false" android:icon="@drawable/launcher" android:label="@string/cosmic_flow_app_name">
!         <service android:icon="@drawable/launcher" android:label="@string/cosmic_flow_app_name" android:name="com.sonyericsson.cosmicflow.LiveWallpaper" android:permission="android.permission.BIND_WALLPAPER">
              <intent-filter>
--- 1,5 ----
! <?xml version="1.0" encoding="utf-8" standalone="no"?><manifest xmlns:android="http://schemas.android.com/apk/res/android">
      <uses-feature android:glEsVersion="0x00020000"/>
!     <application android:icon="@drawable/launcher" android:label="@string/cosmic_flow_app_name">
!         <service android:icon="@drawable/launcher" android:label="@string/cosmic_flow_app_name" android:name="com.sonyericsson.cosmicflow.LiveWallpaper" android:permission="android.permission.BIND_WALLPAPER" android:exported="true">
              <intent-filter>
***************
*** 10,24 ****
          <activity android:exported="true" android:icon="@drawable/launcher" android:label="@string/cosmic_flow_settings_title" android:name="com.sonyericsson.cosmicflow.settings.Settings" android:theme="@android:style/Theme.DeviceDefault"/>
-         <receiver android:name=".ThemeChangeReceiver">
-             <intent-filter>
-                 <action android:name="com.sonyericsson.theme.intent.action.SKIN_PACKAGE_CHANGED"/>
-             </intent-filter>
-         </receiver>
-         <service android:name=".ThemeChangeReceiver$ApplyAccentColorService"/>
-         <receiver android:name=".MasterResetReceiver" android:permission="android.permission.MASTER_CLEAR">
-             <intent-filter>
-                 <action android:name="com.sonyericsson.settings.MASTERRESET"/>
-                 <category android:name="android.intent.category.DEFAULT"/>
-             </intent-filter>
-         </receiver>
-         <service android:name=".MasterResetReceiver$ResetPreferencesService"/>
      </application>
--- 10,11 ----
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/ColorInfo.java new/src/main/java/com/sonyericsson/cosmicflow/ColorInfo.java
*** app/src/main/java/com/sonyericsson/cosmicflow/ColorInfo.java	Mon May  6 12:39:55 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/ColorInfo.java	Mon May  6 12:38:38 2024
***************
*** 6,10 ****
  
- import android.content.res.Resources;
- import android.content.Context;
- import java.util.HashMap;
  
--- 6,7 ----
***************
*** 21,23 ****
      public static final ColorInfo Turquoise;
-     private static HashMap<Integer, ColorInfo> sAccentToBuildInColorMap;
      public final long color;
--- 18,19 ----
***************
*** 27,36 ****
      static {
!         Silk = new ColorInfo("Silk", defineColor(104, 107, 108, 255, 255, 255), 2130837513);
!         Turquoise = new ColorInfo("Turquoise", defineColor(26, 115, 115, 205, 255, 248), 2130837514);
!         Emerald = new ColorInfo("Emerald", defineColor(20, 101, 50, 214, 255, 177), 2130837507);
!         Sapphire = new ColorInfo("Sapphire", defineColor(37, 89, 179, 161, 247, 255), 2130837512);
!         Gold = new ColorInfo("Gold", defineColor(165, 127, 36, 162, 255, 179), 2130837509);
!         Ruby = new ColorInfo("Ruby", defineColor(116, 15, 48, 255, 172, 221), 2130837511);
!         Amethyst = new ColorInfo("Amethyst", defineColor(118, 6, 135, 255, 255, 228), 2130837505);
!         Amber = new ColorInfo("Amber", defineColor(240, 143, 52, 253, 197, 197), 2130837504);
      }
--- 23,32 ----
      static {
!         Silk = new ColorInfo("Silk", defineColor(104, 107, 108, 255, 255, 255), R.drawable.silk);
!         Turquoise = new ColorInfo("Turquoise", defineColor(26, 115, 115, 205, 255, 248), R.drawable.turquoise);
!         Emerald = new ColorInfo("Emerald", defineColor(20, 101, 50, 214, 255, 177), R.drawable.emerald);
!         Sapphire = new ColorInfo("Sapphire", defineColor(37, 89, 179, 161, 247, 255), R.drawable.sapphire);
!         Gold = new ColorInfo("Gold", defineColor(165, 127, 36, 162, 255, 179), R.drawable.gold);
!         Ruby = new ColorInfo("Ruby", defineColor(116, 15, 48, 255, 172, 221), R.drawable.ruby);
!         Amethyst = new ColorInfo("Amethyst", defineColor(118, 6, 135, 255, 255, 228), R.drawable.amethyst);
!         Amber = new ColorInfo("Amber", defineColor(240, 143, 52, 253, 197, 197), R.drawable.amber);
      }
***************
*** 59,78 ****
      
-     public static ColorInfo mapAccentColor(final Context context, final int n) {
-         synchronized (ColorInfo.class) {
-             if (ColorInfo.sAccentToBuildInColorMap == null) {
-                 ColorInfo.sAccentToBuildInColorMap = new HashMap<Integer, ColorInfo>();
-                 final Resources resources = context.getResources();
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099648)), ColorInfo.Silk);
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099649)), ColorInfo.Turquoise);
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099650)), ColorInfo.Emerald);
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099651)), ColorInfo.Sapphire);
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099652)), ColorInfo.Gold);
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099653)), ColorInfo.Ruby);
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099654)), ColorInfo.Amethyst);
-                 ColorInfo.sAccentToBuildInColorMap.put(Integer.valueOf(resources.getColor(2131099655)), ColorInfo.Amber);
-             }
-             return ColorInfo.sAccentToBuildInColorMap.get(Integer.valueOf(n));
-         }
-     }
-     
      private static int rgbBytesToInt(final int n, final int n2, final int n3) {
--- 55,56 ----
***************
*** 84,85 ****
--- 62,71 ----
      }
+ 
+     public static float[] fromHexString(String value){
+         return rgbIntToFloatArray(Integer.decode("0x"+value));
+     }
+     
+     public static float[][] extract(final int n, final int n2) {
+         return new float[][] { rgbIntToFloatArray(n), rgbIntToFloatArray(n2) };
+     }
  }
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/LiveWallpaper.java new/src/main/java/com/sonyericsson/cosmicflow/LiveWallpaper.java
*** app/src/main/java/com/sonyericsson/cosmicflow/LiveWallpaper.java	Mon May  6 12:39:56 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/LiveWallpaper.java	Mon May  6 12:38:38 2024
***************
*** 15,17 ****
  import javax.microedition.khronos.egl.EGL10;
! import android.service.wallpaper.WallpaperService$Engine;
  
--- 15,19 ----
  import javax.microedition.khronos.egl.EGL10;
! import android.service.wallpaper.WallpaperService;
! import com.sonyericsson.cosmicflow.GLWallpaperService;
! import android.opengl.GLSurfaceView;
  
***************
*** 20,22 ****
      @Override
!     public WallpaperService$Engine onCreateEngine() {
          return new WallpaperEngine();
--- 22,24 ----
      @Override
!     public WallpaperService.Engine onCreateEngine() {
          return new WallpaperEngine();
***************
*** 24,26 ****
      
!     static class WallpaperEGLConfigChooser implements EGLConfigChooser
      {
--- 26,28 ----
      
!     static class WallpaperEGLConfigChooser implements GLSurfaceView.EGLConfigChooser
      {
***************
*** 126,138 ****
          private WallpaperEGLConfigChooser mWallpaperEGLConfigChooser;
-         final LiveWallpaper this$0;
          
!         public WallpaperEngine(final LiveWallpaper this$0) {
!             (GLWallpaperService)(this.this$0 = this$0).super();
!             this.mColorPicker = new ColorPicker((Context)this$0);
!             this.mGlRenderer = new FlowRenderer((Context)this$0, this.mColorPicker);
              ((GLEngine)this).setEGLConfigChooser(this.mWallpaperEGLConfigChooser = new WallpaperEGLConfigChooser(new int[] { 12324, 8, 8, 12323, 8, 8, 12322, 8, 8, 12321, 8, 8, 12325, 0, 24, 12326, 0, 8, 12338, 0, 1, 12337, 2, 2, 12352, 0, 7 }, new int[] { 12324, 8, 8, 12323, 8, 8, 12322, 8, 8, 12321, 8, 8, 12325, 0, 24, 12326, 0, 8, 12338, 0, 1, 12337, 0, 4, 12352, 0, 7 }));
!             ((GLEngine)this).setEGLContextFactory(new EGLContextFactory(this, this$0) {
!                 private int EGL_CONTEXT_CLIENT_VERSION = 12440;
!                 final WallpaperEngine this$1;
!                 final LiveWallpaper val$this$0;
                  
--- 128,137 ----
          private WallpaperEGLConfigChooser mWallpaperEGLConfigChooser;
          
!         public WallpaperEngine() {
!             super();
!             this.mColorPicker = new ColorPicker(LiveWallpaper.this);
!             this.mGlRenderer = new FlowRenderer(LiveWallpaper.this, this.mColorPicker);    
              ((GLEngine)this).setEGLConfigChooser(this.mWallpaperEGLConfigChooser = new WallpaperEGLConfigChooser(new int[] { 12324, 8, 8, 12323, 8, 8, 12322, 8, 8, 12321, 8, 8, 12325, 0, 24, 12326, 0, 8, 12338, 0, 1, 12337, 2, 2, 12352, 0, 7 }, new int[] { 12324, 8, 8, 12323, 8, 8, 12322, 8, 8, 12321, 8, 8, 12325, 0, 24, 12326, 0, 8, 12338, 0, 1, 12337, 0, 4, 12352, 0, 7 }));
!             this.setEGLContextFactory(new GLSurfaceView.EGLContextFactory(){
!                private int EGL_CONTEXT_CLIENT_VERSION = 12440;
                  
***************
*** 145,149 ****
                  public void destroyContext(final EGL10 egl10, final EGLDisplay eglDisplay, final EGLContext eglContext) {
!                     if (this.this$1.mGlRenderer != null) {
!                         this.this$1.mGlRenderer.destroy();
!                         this.this$1.mGlRenderer = null;
                      }
--- 144,148 ----
                  public void destroyContext(final EGL10 egl10, final EGLDisplay eglDisplay, final EGLContext eglContext) {
!                     if (mGlRenderer != null) {
!                         mGlRenderer.destroy();
!                         mGlRenderer = null;
                      }
***************
*** 156,164 ****
          
!         private void startAirTouchService(final String s) {
!             final Intent intent = new Intent(s);
!             intent.putExtra("com.sonyericsson.airtouch.service.caller_id", "com.sonyericsson.cosmicflow");
!             this.this$0.startService(intent);
!         }
!         
!         public Renderer getRenderer() {
              return this.mGlRenderer;
--- 155,157 ----
          
!         public GLSurfaceView.Renderer getRenderer() {
              return this.mGlRenderer;
***************
*** 199,208 ****
              this.mGlRenderer.onVisibilityChanged(b, this.isPreview());
-             if (!this.isPreview()) {
-                 if (b) {
-                     this.startAirTouchService("com.sonyericsson.airtouch.service.ACTION_ENABLE");
-                 }
-                 else {
-                     this.startAirTouchService("com.sonyericsson.airtouch.service.ACTION_DISABLE");
-                 }
-             }
          }
--- 192,193 ----
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/gl/FlowRenderer.java new/src/main/java/com/sonyericsson/cosmicflow/gl/FlowRenderer.java
*** app/src/main/java/com/sonyericsson/cosmicflow/gl/FlowRenderer.java	Mon May  6 12:39:57 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/gl/FlowRenderer.java	Mon May  6 12:38:38 2024
***************
*** 11,13 ****
  import android.opengl.Matrix;
! import android.graphics.BitmapFactory$Options;
  import android.opengl.GLES20;
--- 11,13 ----
  import android.opengl.Matrix;
! import android.graphics.BitmapFactory;
  import android.opengl.GLES20;
***************
*** 18,21 ****
  import com.sonyericsson.cosmicflow.GLWallpaperService;
  
! public class FlowRenderer implements Renderer
  {
--- 18,23 ----
  import com.sonyericsson.cosmicflow.GLWallpaperService;
+ import com.sonyericsson.cosmicflow.R;
+ import android.opengl.GLSurfaceView;
  
! public class FlowRenderer implements GLSurfaceView.Renderer
  {
***************
*** 105,110 ****
      
!     public static void checkGlError(final String s) {
          final int glGetError = GLES20.glGetError();
          if (glGetError != 0) {
!             throw new RuntimeException(s + ": glError " + glGetError);
          }
--- 107,112 ----
      
!     public static void checkGlError(final String str) {
          final int glGetError = GLES20.glGetError();
          if (glGetError != 0) {
!             throw new RuntimeException(str + ": glError " + glGetError);
          }
***************
*** 114,119 ****
          if (this.mFlowVertexShader == null) {
!             this.mFlowVertexShader = ShaderFactory.loadText(2131034116, this.mContext);
          }
          if (this.mFlowFragmentShader == null) {
!             this.mFlowFragmentShader = ShaderFactory.loadText(2131034114, this.mContext);
          }
--- 116,121 ----
          if (this.mFlowVertexShader == null) {
!             this.mFlowVertexShader = ShaderFactory.loadText(R.raw.flow_vertex, this.mContext);
          }
          if (this.mFlowFragmentShader == null) {
!             this.mFlowFragmentShader = ShaderFactory.loadText(R.raw.flow_fragment, this.mContext);
          }
***************
*** 124,129 ****
          if (this.mBackgroundVertexShader == null) {
!             this.mBackgroundVertexShader = ShaderFactory.loadText(2131034113, this.mContext);
          }
          if (this.mBackgroundFragmentShader == null) {
!             this.mBackgroundFragmentShader = ShaderFactory.loadText(2131034112, this.mContext);
          }
--- 126,131 ----
          if (this.mBackgroundVertexShader == null) {
!             this.mBackgroundVertexShader = ShaderFactory.loadText(R.raw.background_vertex, this.mContext);
          }
          if (this.mBackgroundFragmentShader == null) {
!             this.mBackgroundFragmentShader = ShaderFactory.loadText(R.raw.background_fragment, this.mContext);
          }
***************
*** 137,142 ****
      private void createTextures() {
!         final BitmapFactory$Options bitmapFactory$Options = new BitmapFactory$Options();
!         bitmapFactory$Options.inDither = false;
          if (this.mFlowBitmap == null) {
!             this.mFlowBitmap = Texture.decodeBitmap(this.mContext, 2131034115, bitmapFactory$Options);
          }
--- 139,144 ----
      private void createTextures() {
!         BitmapFactory.Options options = new BitmapFactory.Options();
!         options.inDither = false;
          if (this.mFlowBitmap == null) {
!              this.mFlowBitmap = Texture.decodeBitmap(this.mContext, R.raw.flow_greyscale, options);
          }
***************
*** 147,149 ****
          if (this.mBackgroundBitmap == null) {
!             this.mBackgroundBitmap = Texture.decodeBitmap(this.mContext, 2130837506, null);
          }
--- 149,151 ----
          if (this.mBackgroundBitmap == null) {
!            this.mBackgroundBitmap = Texture.decodeBitmap(this.mContext, R.drawable.bg_grey, null);
          }
***************
*** 176,178 ****
          GLES20.glClear(16640);
!         this.renderBackground(this.mBackgroundProgram, this.mBackgroundTexture, this.mSquareVertexBufferObject);
          this.renderFlow();
--- 178,184 ----
          GLES20.glClear(16640);
!         if (this.mColorPicker.isDarkMode){
!             if (!this.mColorPicker.bgBloomDisable) {
!                 this.renderBackground(this.mBackgroundProgram, this.mBackgroundTexture, this.mSquareVertexBufferObject);
!             }
!         }
          this.renderFlow();
***************
*** 343,345 ****
          GLES20.glEnable(32925);
!         if (GLES20.glGetError() != 0) {}
          if (this.mViewportWidth <= this.mViewportHeight) {
--- 349,351 ----
          GLES20.glEnable(32925);
!         GLES20.glGetError();
          if (this.mViewportWidth <= this.mViewportHeight) {
***************
*** 361,365 ****
          GLES20.glDisable(3024);
!         GLES20.glBlendFunc(770, 1);
!         GLES20.glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
!         this.createTextures();
          this.createShaders();
--- 367,375 ----
          GLES20.glDisable(3024);
!         if(mColorPicker.isDarkMode){
!             GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE);
!             GLES20.glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
!         } else {
!             GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_SRC_COLOR);
!             GLES20.glClearColor(1.0f, 1.0f, 1.0f, 1.0f);
!         }this.createTextures();
          this.createShaders();
***************
*** 420,496 ****
          
!         public void sleep(final long p0) {
!             // 
!             // This method could not be decompiled.
!             // 
!             // Original Bytecode:
!             // 
!             //     1: monitorenter   
!             //     2: lload_1        
!             //     3: lconst_0       
!             //     4: lcmp           
!             //     5: ifgt            11
!             //     8: aload_0        
!             //     9: monitorexit    
!             //    10: return         
!             //    11: lload_1        
!             //    12: lstore_3       
!             //    13: lload_1        
!             //    14: l2f            
!             //    15: ldc             83.333336
!             //    17: fcmpl          
!             //    18: ifle            25
!             //    21: ldc2_w          83
!             //    24: lstore_3       
!             //    25: aload_0        
!             //    26: iconst_1       
!             //    27: putfield        com/sonyericsson/cosmicflow/gl/FlowRenderer$FrameLock.mAsleep:Z
!             //    30: aload_0        
!             //    31: lload_3        
!             //    32: invokevirtual   java/lang/Object.wait:(J)V
!             //    35: aload_0        
!             //    36: iconst_0       
!             //    37: putfield        com/sonyericsson/cosmicflow/gl/FlowRenderer$FrameLock.mAsleep:Z
!             //    40: goto            8
!             //    43: astore          5
!             //    45: aload_0        
!             //    46: monitorexit    
!             //    47: aload           5
!             //    49: athrow         
!             //    50: astore          5
!             //    52: goto            35
!             //    Exceptions:
!             //  Try           Handler
!             //  Start  End    Start  End    Type                            
!             //  -----  -----  -----  -----  --------------------------------
!             //  25     30     43     50     Any
!             //  30     35     50     55     Ljava/lang/InterruptedException;
!             //  30     35     43     50     Any
!             //  35     40     43     50     Any
!             // 
!             // The error that occurred was:
!             // 
!             // java.lang.IllegalStateException: Expression is linked from several locations: Label_0035:
!             //     at com.strobel.decompiler.ast.Error.expressionLinkedFromMultipleLocations(Error.java:27)
!             //     at com.strobel.decompiler.ast.AstOptimizer.mergeDisparateObjectInitializations(AstOptimizer.java:2604)
!             //     at com.strobel.decompiler.ast.AstOptimizer.optimize(AstOptimizer.java:235)
!             //     at com.strobel.decompiler.ast.AstOptimizer.optimize(AstOptimizer.java:42)
!             //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:206)
!             //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:93)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethodBody(AstBuilder.java:868)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethod(AstBuilder.java:761)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addTypeMembers(AstBuilder.java:638)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeCore(AstBuilder.java:605)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeNoCache(AstBuilder.java:195)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addTypeMembers(AstBuilder.java:662)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeCore(AstBuilder.java:605)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeNoCache(AstBuilder.java:195)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createType(AstBuilder.java:162)
!             //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addType(AstBuilder.java:137)
!             //     at com.strobel.decompiler.languages.java.JavaLanguage.buildAst(JavaLanguage.java:71)
!             //     at com.strobel.decompiler.languages.java.JavaLanguage.decompileType(JavaLanguage.java:59)
!             //     at com.strobel.decompiler.DecompilerDriver.decompileType(DecompilerDriver.java:333)
!             //     at com.strobel.decompiler.DecompilerDriver.decompileJar(DecompilerDriver.java:254)
!             //     at com.strobel.decompiler.DecompilerDriver.main(DecompilerDriver.java:129)
!             // 
!             throw new IllegalStateException("An error occurred while decompiling this method.");
          }
--- 430,440 ----
          
!         public synchronized void sleep(float sleepTime) {
!                 if (sleepTime > 0f) {
!                     this.mAsleep = true;
!                     try {
!                         wait((long) sleepTime);
!                     } catch (InterruptedException ignored) {
!                     }
!                     this.mAsleep = false;
!                 }
          }
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/gl/MeshPrimitive.java new/src/main/java/com/sonyericsson/cosmicflow/gl/MeshPrimitive.java
*** app/src/main/java/com/sonyericsson/cosmicflow/gl/MeshPrimitive.java	Mon May  6 12:39:57 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/gl/MeshPrimitive.java	Mon May  6 12:38:38 2024
***************
*** 75,77 ****
          public FlowMeshPrimitive(final short n) {
!             super(vertices(n), indices(n), null, null);
          }
--- 75,77 ----
          public FlowMeshPrimitive(final short n) {
!             super(vertices(n), indices(n), null);
          }
***************
*** 81,83 ****
              final short n3 = (short)((n - 1) * n2);
!             final short[] array = new short[n3];
              for (short n4 = 0; n4 < n - 1; ++n4) {
--- 81,83 ----
              final short n3 = (short)((n - 1) * n2);
!             final short[] src = new short[n3];
              for (short n4 = 0; n4 < n - 1; ++n4) {
***************
*** 86,98 ****
                      final short n7 = (short)(n5 + 1);
!                     array[n5] = (short)(n4 * n + n6);
                      n5 = (short)(n7 + 1);
!                     array[n7] = (short)((n4 + 1) * n + n6);
                  }
                  final short n8 = (short)(n5 + 1);
!                 array[n5] = (short)((n4 + 1) * n + n - 1);
                  final short n9 = (short)(n8 + 1);
!                 array[n8] = (short)((n4 + 1) * n);
              }
              final ShortBuffer shortBuffer = ByteBuffer.allocateDirect(n3 * 2).order(ByteOrder.nativeOrder()).asShortBuffer();
!             shortBuffer.put(array);
              shortBuffer.position(0);
--- 86,98 ----
                      final short n7 = (short)(n5 + 1);
!                     src[n5] = (short)(n4 * n + n6);
                      n5 = (short)(n7 + 1);
!                     src[n7] = (short)((n4 + 1) * n + n6);
                  }
                  final short n8 = (short)(n5 + 1);
!                 src[n5] = (short)((n4 + 1) * n + n - 1);
                  final short n9 = (short)(n8 + 1);
!                 src[n8] = (short)((n4 + 1) * n);
              }
              final ShortBuffer shortBuffer = ByteBuffer.allocateDirect(n3 * 2).order(ByteOrder.nativeOrder()).asShortBuffer();
!             shortBuffer.put(src);
              shortBuffer.position(0);
***************
*** 103,110 ****
              final int n2 = n * n;
!             final float[] array = new float[n2 * 3];
              for (int i = 0; i < n; ++i) {
                  for (int n3 = i * n * 3, j = 0; j < n; ++j, n3 += 3) {
!                     array[n3 + 0] = j * 1.0f / n;
!                     array[n3 + 1] = i * 0.7f / n;
!                     array[n3 + 2] = 0.0f;
                  }
--- 103,110 ----
              final int n2 = n * n;
!             final float[] src = new float[n2 * 3];
              for (int i = 0; i < n; ++i) {
                  for (int n3 = i * n * 3, j = 0; j < n; ++j, n3 += 3) {
!                     src[n3 + 0] = j * 1.0f / n;
!                     src[n3 + 1] = i * 0.7f / n;
!                     src[n3 + 2] = 0.0f;
                  }
***************
*** 112,114 ****
              final FloatBuffer floatBuffer = ByteBuffer.allocateDirect(n2 * 3 * 4).order(ByteOrder.nativeOrder()).asFloatBuffer();
!             floatBuffer.put(array);
              floatBuffer.position(0);
--- 112,114 ----
              final FloatBuffer floatBuffer = ByteBuffer.allocateDirect(n2 * 3 * 4).order(ByteOrder.nativeOrder()).asFloatBuffer();
!             floatBuffer.put(src);
              floatBuffer.position(0);
***************
*** 121,123 ****
          public SquareMeshPrimitive(final float n, final float n2) {
!             super(vertices(n, n2), indices(), texture(), null);
          }
--- 121,123 ----
          public SquareMeshPrimitive(final float n, final float n2) {
!             super(vertices(n, n2), indices(), texture());
          }
***************
*** 125,136 ****
          private static ShortBuffer indices() {
!             final short[] array2;
!             final short[] array = array2 = new short[6];
!             array2[0] = 0;
!             array2[1] = 1;
!             array2[2] = 2;
!             array2[3] = 1;
!             array2[4] = 2;
!             array2[5] = 3;
!             final ShortBuffer shortBuffer = ByteBuffer.allocateDirect(array.length * 2).order(ByteOrder.nativeOrder()).asShortBuffer();
!             shortBuffer.put(array);
              shortBuffer.position(0);
--- 125,136 ----
          private static ShortBuffer indices() {
!             final short[] array;
!             final short[] src = array = new short[6];
!             array[0] = 0;
!             array[1] = 1;
!             array[2] = 2;
!             array[3] = 1;
!             array[4] = 2;
!             array[5] = 3;
!             final ShortBuffer shortBuffer = ByteBuffer.allocateDirect(src.length * 2).order(ByteOrder.nativeOrder()).asShortBuffer();
!             shortBuffer.put(src);
              shortBuffer.position(0);
***************
*** 140,150 ****
          private static FloatBuffer texture() {
!             final float[] array2;
!             final float[] array = array2 = new float[8];
!             array2[1] = (array2[0] = 0.0f);
!             array2[2] = 1.0f;
!             array2[4] = (array2[3] = 0.0f);
!             array2[5] = 1.0f;
!             array2[7] = (array2[6] = 1.0f);
!             final FloatBuffer floatBuffer = ByteBuffer.allocateDirect(array.length * 3 * 4).order(ByteOrder.nativeOrder()).asFloatBuffer();
!             floatBuffer.put(array);
              floatBuffer.position(0);
--- 140,150 ----
          private static FloatBuffer texture() {
!             final float[] array;
!             final float[] src = array = new float[8];
!             array[1] = (array[0] = 0.0f);
!             array[2] = 1.0f;
!             array[4] = (array[3] = 0.0f);
!             array[5] = 1.0f;
!             array[7] = (array[6] = 1.0f);
!             final FloatBuffer floatBuffer = ByteBuffer.allocateDirect(src.length * 3 * 4).order(ByteOrder.nativeOrder()).asFloatBuffer();
!             floatBuffer.put(src);
              floatBuffer.position(0);
***************
*** 154,158 ****
          private static FloatBuffer vertices(final float n, final float n2) {
!             final float[] array = { -n, n2, 0.02f, n, n2, 0.02f, -n, -n2, 0.02f, n, -n2, 0.02f };
!             final FloatBuffer floatBuffer = ByteBuffer.allocateDirect(array.length * 4).order(ByteOrder.nativeOrder()).asFloatBuffer();
!             floatBuffer.put(array);
              floatBuffer.position(0);
--- 154,158 ----
          private static FloatBuffer vertices(final float n, final float n2) {
!             final float[] src = { -n, n2, 0.02f, n, n2, 0.02f, -n, -n2, 0.02f, n, -n2, 0.02f };
!             final FloatBuffer floatBuffer = ByteBuffer.allocateDirect(src.length * 4).order(ByteOrder.nativeOrder()).asFloatBuffer();
!             floatBuffer.put(src);
              floatBuffer.position(0);
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderFactory.java new/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderFactory.java
*** app/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderFactory.java	Mon May  6 12:39:57 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderFactory.java	Mon May  6 12:38:38 2024
***************
*** 21,321 ****
      
!     public static String loadText(final int p0, final Context p1) {
!         // 
!         // This method could not be decompiled.
!         // 
!         // Original Bytecode:
!         // 
!         //     1: astore_3       
!         //     2: aconst_null    
!         //     3: astore          5
!         //     5: aconst_null    
!         //     6: astore          6
!         //     8: aconst_null    
!         //     9: astore          4
!         //    11: aload_1        
!         //    12: invokevirtual   android/content/Context.getResources:()Landroid/content/res/Resources;
!         //    15: iload_0        
!         //    16: invokevirtual   android/content/res/Resources.openRawResource:(I)Ljava/io/InputStream;
!         //    19: astore_1       
!         //    20: aload_1        
!         //    21: astore          4
!         //    23: aload_1        
!         //    24: astore_3       
!         //    25: aload_1        
!         //    26: astore          5
!         //    28: aload_1        
!         //    29: astore          6
!         //    31: aload_1        
!         //    32: invokevirtual   java/io/InputStream.available:()I
!         //    35: newarray        B
!         //    37: astore          7
!         //    39: aload_1        
!         //    40: astore          4
!         //    42: aload_1        
!         //    43: astore_3       
!         //    44: aload_1        
!         //    45: astore          5
!         //    47: aload_1        
!         //    48: astore          6
!         //    50: aload_1        
!         //    51: aload           7
!         //    53: invokevirtual   java/io/InputStream.read:([B)I
!         //    56: istore_2       
!         //    57: iload_2        
!         //    58: ifgt            226
!         //    61: aload_1        
!         //    62: astore          4
!         //    64: aload_1        
!         //    65: astore_3       
!         //    66: aload_1        
!         //    67: astore          5
!         //    69: aload_1        
!         //    70: astore          6
!         //    72: new             Ljava/lang/RuntimeException;
!         //    75: astore          7
!         //    77: aload_1        
!         //    78: astore          4
!         //    80: aload_1        
!         //    81: astore_3       
!         //    82: aload_1        
!         //    83: astore          5
!         //    85: aload_1        
!         //    86: astore          6
!         //    88: new             Ljava/lang/StringBuilder;
!         //    91: astore          8
!         //    93: aload_1        
!         //    94: astore          4
!         //    96: aload_1        
!         //    97: astore_3       
!         //    98: aload_1        
!         //    99: astore          5
!         //   101: aload_1        
!         //   102: astore          6
!         //   104: aload           8
!         //   106: invokespecial   java/lang/StringBuilder.<init>:()V
!         //   109: aload_1        
!         //   110: astore          4
!         //   112: aload_1        
!         //   113: astore_3       
!         //   114: aload_1        
!         //   115: astore          5
!         //   117: aload_1        
!         //   118: astore          6
!         //   120: aload           7
!         //   122: aload           8
!         //   124: ldc             "ShaderFactoryObject: Error loading resId="
!         //   126: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
!         //   129: iload_0        
!         //   130: invokevirtual   java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
!         //   133: ldc             " nbrBytes="
!         //   135: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
!         //   138: iload_2        
!         //   139: invokevirtual   java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
!         //   142: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
!         //   145: invokespecial   java/lang/RuntimeException.<init>:(Ljava/lang/String;)V
!         //   148: aload_1        
!         //   149: astore          4
!         //   151: aload_1        
!         //   152: astore_3       
!         //   153: aload_1        
!         //   154: astore          5
!         //   156: aload_1        
!         //   157: astore          6
!         //   159: aload           7
!         //   161: athrow         
!         //   162: astore          5
!         //   164: aload           4
!         //   166: astore_3       
!         //   167: new             Ljava/lang/RuntimeException;
!         //   170: astore_1       
!         //   171: aload           4
!         //   173: astore_3       
!         //   174: new             Ljava/lang/StringBuilder;
!         //   177: astore          6
!         //   179: aload           4
!         //   181: astore_3       
!         //   182: aload           6
!         //   184: invokespecial   java/lang/StringBuilder.<init>:()V
!         //   187: aload           4
!         //   189: astore_3       
!         //   190: aload_1        
!         //   191: aload           6
!         //   193: ldc             "ShaderFactoryObject: Error loading resId="
!         //   195: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
!         //   198: iload_0        
!         //   199: invokevirtual   java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
!         //   202: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
!         //   205: aload           5
!         //   207: invokespecial   java/lang/RuntimeException.<init>:(Ljava/lang/String;Ljava/lang/Throwable;)V
!         //   210: aload           4
!         //   212: astore_3       
!         //   213: aload_1        
!         //   214: athrow         
!         //   215: astore_1       
!         //   216: aload_3        
!         //   217: ifnull          224
!         //   220: aload_3        
!         //   221: invokevirtual   java/io/InputStream.close:()V
!         //   224: aload_1        
!         //   225: athrow         
!         //   226: aload_1        
!         //   227: astore          4
!         //   229: aload_1        
!         //   230: astore_3       
!         //   231: aload_1        
!         //   232: astore          5
!         //   234: aload_1        
!         //   235: astore          6
!         //   237: new             Ljava/lang/String;
!         //   240: dup            
!         //   241: aload           7
!         //   243: invokespecial   java/lang/String.<init>:([B)V
!         //   246: astore          7
!         //   248: aload_1        
!         //   249: ifnull          256
!         //   252: aload_1        
!         //   253: invokevirtual   java/io/InputStream.close:()V
!         //   256: aload           7
!         //   258: areturn        
!         //   259: astore_1       
!         //   260: aload           5
!         //   262: astore_3       
!         //   263: new             Ljava/lang/RuntimeException;
!         //   266: astore          4
!         //   268: aload           5
!         //   270: astore_3       
!         //   271: new             Ljava/lang/StringBuilder;
!         //   274: astore          6
!         //   276: aload           5
!         //   278: astore_3       
!         //   279: aload           6
!         //   281: invokespecial   java/lang/StringBuilder.<init>:()V
!         //   284: aload           5
!         //   286: astore_3       
!         //   287: aload           4
!         //   289: aload           6
!         //   291: ldc             "ShaderFactoryObject: Error loading resId="
!         //   293: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
!         //   296: iload_0        
!         //   297: invokevirtual   java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
!         //   300: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
!         //   303: aload_1        
!         //   304: invokespecial   java/lang/RuntimeException.<init>:(Ljava/lang/String;Ljava/lang/Throwable;)V
!         //   307: aload           5
!         //   309: astore_3       
!         //   310: aload           4
!         //   312: athrow         
!         //   313: astore          5
!         //   315: aload           6
!         //   317: astore_3       
!         //   318: new             Ljava/lang/RuntimeException;
!         //   321: astore          4
!         //   323: aload           6
!         //   325: astore_3       
!         //   326: new             Ljava/lang/StringBuilder;
!         //   329: astore_1       
!         //   330: aload           6
!         //   332: astore_3       
!         //   333: aload_1        
!         //   334: invokespecial   java/lang/StringBuilder.<init>:()V
!         //   337: aload           6
!         //   339: astore_3       
!         //   340: aload           4
!         //   342: aload_1        
!         //   343: ldc             "ShaderFactoryObject: Error loading resId="
!         //   345: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
!         //   348: iload_0        
!         //   349: invokevirtual   java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
!         //   352: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
!         //   355: aload           5
!         //   357: invokespecial   java/lang/RuntimeException.<init>:(Ljava/lang/String;Ljava/lang/Throwable;)V
!         //   360: aload           6
!         //   362: astore_3       
!         //   363: aload           4
!         //   365: athrow         
!         //   366: astore_1       
!         //   367: goto            256
!         //   370: astore_3       
!         //   371: goto            224
!         //    Exceptions:
!         //  Try           Handler
!         //  Start  End    Start  End    Type                                             
!         //  -----  -----  -----  -----  -------------------------------------------------
!         //  11     20     162    215    Landroid/content/res/Resources$NotFoundException;
!         //  11     20     259    313    Ljava/io/IOException;
!         //  11     20     313    366    Ljava/lang/RuntimeException;
!         //  11     20     215    226    Any
!         //  31     39     162    215    Landroid/content/res/Resources$NotFoundException;
!         //  31     39     259    313    Ljava/io/IOException;
!         //  31     39     313    366    Ljava/lang/RuntimeException;
!         //  31     39     215    226    Any
!         //  50     57     162    215    Landroid/content/res/Resources$NotFoundException;
!         //  50     57     259    313    Ljava/io/IOException;
!         //  50     57     313    366    Ljava/lang/RuntimeException;
!         //  50     57     215    226    Any
!         //  72     77     162    215    Landroid/content/res/Resources$NotFoundException;
!         //  72     77     259    313    Ljava/io/IOException;
!         //  72     77     313    366    Ljava/lang/RuntimeException;
!         //  72     77     215    226    Any
!         //  88     93     162    215    Landroid/content/res/Resources$NotFoundException;
!         //  88     93     259    313    Ljava/io/IOException;
!         //  88     93     313    366    Ljava/lang/RuntimeException;
!         //  88     93     215    226    Any
!         //  104    109    162    215    Landroid/content/res/Resources$NotFoundException;
!         //  104    109    259    313    Ljava/io/IOException;
!         //  104    109    313    366    Ljava/lang/RuntimeException;
!         //  104    109    215    226    Any
!         //  120    148    162    215    Landroid/content/res/Resources$NotFoundException;
!         //  120    148    259    313    Ljava/io/IOException;
!         //  120    148    313    366    Ljava/lang/RuntimeException;
!         //  120    148    215    226    Any
!         //  159    162    162    215    Landroid/content/res/Resources$NotFoundException;
!         //  159    162    259    313    Ljava/io/IOException;
!         //  159    162    313    366    Ljava/lang/RuntimeException;
!         //  159    162    215    226    Any
!         //  167    171    215    226    Any
!         //  174    179    215    226    Any
!         //  182    187    215    226    Any
!         //  190    210    215    226    Any
!         //  213    215    215    226    Any
!         //  220    224    370    374    Ljava/io/IOException;
!         //  237    248    162    215    Landroid/content/res/Resources$NotFoundException;
!         //  237    248    259    313    Ljava/io/IOException;
!         //  237    248    313    366    Ljava/lang/RuntimeException;
!         //  237    248    215    226    Any
!         //  252    256    366    370    Ljava/io/IOException;
!         //  263    268    215    226    Any
!         //  271    276    215    226    Any
!         //  279    284    215    226    Any
!         //  287    307    215    226    Any
!         //  310    313    215    226    Any
!         //  318    323    215    226    Any
!         //  326    330    215    226    Any
!         //  333    337    215    226    Any
!         //  340    360    215    226    Any
!         //  363    366    215    226    Any
!         // 
!         // The error that occurred was:
!         // 
!         // java.lang.IllegalStateException: Expression is linked from several locations: Label_0224:
!         //     at com.strobel.decompiler.ast.Error.expressionLinkedFromMultipleLocations(Error.java:27)
!         //     at com.strobel.decompiler.ast.AstOptimizer.mergeDisparateObjectInitializations(AstOptimizer.java:2604)
!         //     at com.strobel.decompiler.ast.AstOptimizer.optimize(AstOptimizer.java:235)
!         //     at com.strobel.decompiler.ast.AstOptimizer.optimize(AstOptimizer.java:42)
!         //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:206)
!         //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:93)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethodBody(AstBuilder.java:868)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethod(AstBuilder.java:761)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addTypeMembers(AstBuilder.java:638)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeCore(AstBuilder.java:605)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeNoCache(AstBuilder.java:195)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createType(AstBuilder.java:162)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addType(AstBuilder.java:137)
!         //     at com.strobel.decompiler.languages.java.JavaLanguage.buildAst(JavaLanguage.java:71)
!         //     at com.strobel.decompiler.languages.java.JavaLanguage.decompileType(JavaLanguage.java:59)
!         //     at com.strobel.decompiler.DecompilerDriver.decompileType(DecompilerDriver.java:333)
!         //     at com.strobel.decompiler.DecompilerDriver.decompileJar(DecompilerDriver.java:254)
!         //     at com.strobel.decompiler.DecompilerDriver.main(DecompilerDriver.java:129)
!         // 
!         throw new IllegalStateException("An error occurred while decompiling this method.");
      }
--- 21,32 ----
      
!     public static String loadText(int resId, Context context) {
!        try(java.io.InputStream shader = context.getResources().openRawResource(resId)) {
!            int size = shader.available();
!            byte[] b = new byte[size];
!            int checkSize = shader.read(b);
!            if (checkSize<=0) throw new Exception("Read and expected length mismatch!");
!            return new String(b);
!        } catch (Exception e) {
!            throw new RuntimeException(e);
!        }
      }
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderProgram.java new/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderProgram.java
*** app/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderProgram.java	Mon May  6 12:39:57 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/gl/ShaderProgram.java	Mon May  6 12:38:38 2024
***************
*** 41,44 ****
      
!     private static int loadShader(final int n, final String s) {
!         if (s == null || s.length() <= 0) {
              throw new RuntimeException("Could not create " + n + " shader. Invalid input");
--- 41,44 ----
      
!     private static int loadShader(final int n, final String str) {
!         if (str == null || str.length() <= 0) {
              throw new RuntimeException("Could not create " + n + " shader. Invalid input");
***************
*** 50,52 ****
          }
!         GLES20.glShaderSource(glCreateShader, s);
          GLES20.glCompileShader(glCreateShader);
--- 50,52 ----
          }
!         GLES20.glShaderSource(glCreateShader, str);
          GLES20.glCompileShader(glCreateShader);
***************
*** 56,58 ****
              GLES20.glDeleteShader(glCreateShader);
!             throw new RuntimeException("Could not compile shader: " + GLES20.glGetShaderInfoLog(glCreateShader) + "\n" + s);
          }
--- 56,58 ----
              GLES20.glDeleteShader(glCreateShader);
!             throw new RuntimeException("Could not compile shader: " + GLES20.glGetShaderInfoLog(glCreateShader) + "\n" + str);
          }
***************
*** 73,76 ****
      public int getAttributeHandle(final String s) {
!         Integer value;
!         if ((value = Integer.valueOf(this.mLocationCache.get((Object)s))) == null) {
              final int glGetAttribLocation = GLES20.glGetAttribLocation(this.mProgram, s);
--- 73,76 ----
      public int getAttributeHandle(final String s) {
!         Integer value = this.mLocationCache.get(s);
!         if (value == null) {
              final int glGetAttribLocation = GLES20.glGetAttribLocation(this.mProgram, s);
***************
*** 88,91 ****
      public int getUniformHandle(final String s) {
!         Integer value;
!         if ((value = Integer.valueOf(this.mLocationCache.get((Object)s))) == null) {
              final int glGetUniformLocation = GLES20.glGetUniformLocation(this.mProgram, s);
--- 88,91 ----
      public int getUniformHandle(final String s) {
!         Integer value = this.mLocationCache.get(s);
!         if (value == null) {
              final int glGetUniformLocation = GLES20.glGetUniformLocation(this.mProgram, s);
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/gl/Texture.java new/src/main/java/com/sonyericsson/cosmicflow/gl/Texture.java
*** app/src/main/java/com/sonyericsson/cosmicflow/gl/Texture.java	Mon May  6 12:39:57 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/gl/Texture.java	Mon May  6 12:38:38 2024
***************
*** 8,10 ****
  import android.graphics.Bitmap;
! import android.graphics.BitmapFactory$Options;
  import android.content.Context;
--- 8,11 ----
  import android.graphics.Bitmap;
! import android.graphics.BitmapFactory;
! import java.io.InputStream;
  import android.content.Context;
***************
*** 18,24 ****
      
!     private Texture(final int mId) {
!         if (mId == 0) {
!             throw new IllegalArgumentException("id=" + mId);
          }
!         this.mId = mId;
      }
--- 19,25 ----
      
!     private Texture(final int n) {
!         if (n == 0) {
!             throw new IllegalArgumentException("id=" + n);
          }
!         this.mId = n;
      }
***************
*** 27,30 ****
          final ByteBuffer allocate = ByteBuffer.allocate(n * n2 * 4);
!         allocate.limit(allocate.capacity());
!         allocate.position(0);
          final int[] array = { 0 };
--- 28,31 ----
          final ByteBuffer allocate = ByteBuffer.allocate(n * n2 * 4);
!         allocate.limit();
!         allocate.position();
          final int[] array = { 0 };
***************
*** 39,178 ****
      
!     public static Bitmap decodeBitmap(final Context p0, final int p1, final BitmapFactory$Options p2) {
!         // 
!         // This method could not be decompiled.
!         // 
!         // Original Bytecode:
!         // 
!         //     1: astore_3       
!         //     2: aconst_null    
!         //     3: astore          4
!         //     5: aload_0        
!         //     6: invokevirtual   android/content/Context.getResources:()Landroid/content/res/Resources;
!         //     9: iload_1        
!         //    10: invokevirtual   android/content/res/Resources.openRawResource:(I)Ljava/io/InputStream;
!         //    13: astore_0       
!         //    14: aload_2        
!         //    15: ifnonnull       42
!         //    18: aload_0        
!         //    19: astore          4
!         //    21: aload_0        
!         //    22: astore_3       
!         //    23: aload_0        
!         //    24: invokestatic    android/graphics/BitmapFactory.decodeStream:(Ljava/io/InputStream;)Landroid/graphics/Bitmap;
!         //    27: astore_2       
!         //    28: aload_2        
!         //    29: astore_3       
!         //    30: aload_0        
!         //    31: ifnull          40
!         //    34: aload_0        
!         //    35: invokevirtual   java/io/InputStream.close:()V
!         //    38: aload_2        
!         //    39: astore_3       
!         //    40: aload_3        
!         //    41: areturn        
!         //    42: aload_0        
!         //    43: astore          4
!         //    45: aload_0        
!         //    46: astore_3       
!         //    47: aload_0        
!         //    48: aconst_null    
!         //    49: aload_2        
!         //    50: invokestatic    android/graphics/BitmapFactory.decodeStream:(Ljava/io/InputStream;Landroid/graphics/Rect;Landroid/graphics/BitmapFactory$Options;)Landroid/graphics/Bitmap;
!         //    53: astore_2       
!         //    54: aload_2        
!         //    55: astore_3       
!         //    56: aload_0        
!         //    57: ifnull          40
!         //    60: aload_0        
!         //    61: invokevirtual   java/io/InputStream.close:()V
!         //    64: aload_2        
!         //    65: astore_3       
!         //    66: goto            40
!         //    69: astore_0       
!         //    70: aload_2        
!         //    71: astore_3       
!         //    72: goto            40
!         //    75: astore_2       
!         //    76: aload           4
!         //    78: astore_3       
!         //    79: new             Ljava/lang/RuntimeException;
!         //    82: astore_0       
!         //    83: aload           4
!         //    85: astore_3       
!         //    86: new             Ljava/lang/StringBuilder;
!         //    89: astore          5
!         //    91: aload           4
!         //    93: astore_3       
!         //    94: aload           5
!         //    96: invokespecial   java/lang/StringBuilder.<init>:()V
!         //    99: aload           4
!         //   101: astore_3       
!         //   102: aload_0        
!         //   103: aload           5
!         //   105: ldc             "Error loading resource   source="
!         //   107: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
!         //   110: iload_1        
!         //   111: invokevirtual   java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
!         //   114: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
!         //   117: aload_2        
!         //   118: invokespecial   java/lang/RuntimeException.<init>:(Ljava/lang/String;Ljava/lang/Throwable;)V
!         //   121: aload           4
!         //   123: astore_3       
!         //   124: aload_0        
!         //   125: athrow         
!         //   126: astore_0       
!         //   127: aload_3        
!         //   128: ifnull          135
!         //   131: aload_3        
!         //   132: invokevirtual   java/io/InputStream.close:()V
!         //   135: aload_0        
!         //   136: athrow         
!         //   137: astore_0       
!         //   138: aload_2        
!         //   139: astore_3       
!         //   140: goto            40
!         //   143: astore_2       
!         //   144: goto            135
!         //    Exceptions:
!         //  Try           Handler
!         //  Start  End    Start  End    Type                        
!         //  -----  -----  -----  -----  ----------------------------
!         //  5      14     75     126    Ljava/lang/RuntimeException;
!         //  5      14     126    137    Any
!         //  23     28     75     126    Ljava/lang/RuntimeException;
!         //  23     28     126    137    Any
!         //  34     38     137    143    Ljava/io/IOException;
!         //  47     54     75     126    Ljava/lang/RuntimeException;
!         //  47     54     126    137    Any
!         //  60     64     69     75     Ljava/io/IOException;
!         //  79     83     126    137    Any
!         //  86     91     126    137    Any
!         //  94     99     126    137    Any
!         //  102    121    126    137    Any
!         //  124    126    126    137    Any
!         //  131    135    143    147    Ljava/io/IOException;
!         // 
!         // The error that occurred was:
!         // 
!         // java.lang.IndexOutOfBoundsException: Index: 91, Size: 91
!         //     at java.util.ArrayList.rangeCheck(Unknown Source)
!         //     at java.util.ArrayList.get(Unknown Source)
!         //     at com.strobel.decompiler.ast.AstBuilder.convertToAst(AstBuilder.java:3362)
!         //     at com.strobel.decompiler.ast.AstBuilder.build(AstBuilder.java:112)
!         //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:203)
!         //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:93)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethodBody(AstBuilder.java:868)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethod(AstBuilder.java:761)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addTypeMembers(AstBuilder.java:638)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeCore(AstBuilder.java:605)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeNoCache(AstBuilder.java:195)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createType(AstBuilder.java:162)
!         //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addType(AstBuilder.java:137)
!         //     at com.strobel.decompiler.languages.java.JavaLanguage.buildAst(JavaLanguage.java:71)
!         //     at com.strobel.decompiler.languages.java.JavaLanguage.decompileType(JavaLanguage.java:59)
!         //     at com.strobel.decompiler.DecompilerDriver.decompileType(DecompilerDriver.java:333)
!         //     at com.strobel.decompiler.DecompilerDriver.decompileJar(DecompilerDriver.java:254)
!         //     at com.strobel.decompiler.DecompilerDriver.main(DecompilerDriver.java:129)
!         // 
!         throw new IllegalStateException("An error occurred while decompiling this method.");
      }
--- 40,53 ----
      
!     public static Bitmap decodeBitmap(final Context context, final int resId, final BitmapFactory.Options options) {
!         Bitmap bitmap;
!         try(InputStream bitmapStream = context.getResources().openRawResource(resId)) {
!             if (options == null) {
!                 bitmap = BitmapFactory.decodeStream(bitmapStream);
!             } else {
!                 bitmap = BitmapFactory.decodeStream(bitmapStream, null, options);
!             }
!             return bitmap;
!         } catch (Exception e) {
!             throw new RuntimeException(e);
!         }
      }
diff '--context=1' --strip-trailing-cr -r app/src/main/java/com/sonyericsson/cosmicflow/gl/VertexBufferObject.java new/src/main/java/com/sonyericsson/cosmicflow/gl/VertexBufferObject.java
*** app/src/main/java/com/sonyericsson/cosmicflow/gl/VertexBufferObject.java	Mon May  6 12:39:57 2024
--- new/src/main/java/com/sonyericsson/cosmicflow/gl/VertexBufferObject.java	Mon May  6 12:38:38 2024
***************
*** 18,54 ****
      public VertexBufferObject(final MeshPrimitive meshPrimitive) {
!         int[] array = null;
!         Label_0065: {
!             if (!meshPrimitive.isTextured()) {
!                 break Label_0065;
!             }
              this.mTextureBuffer = meshPrimitive.getTextureBuffer();
!             while (true) {
!                 this.mIndexSize = meshPrimitive.getNumIndices();
!                 final int[] array2;
!                 array = (array2 = new int[2]);
!                 array2[1] = (array2[0] = -1);
!                 GLES20.glGenBuffers(2, array, 0);
!                 if (array[0] >= 0) {
!                     if (array[1] >= 0) {
!                         break Label_0065;
!                     }
!                 }
!                 try {
!                     FlowRenderer.checkGlError("VertexBufferObject glGenBuffers");
!                     return;
!                     this.mTextureBuffer = null;
!                     continue;
!                 }
!                 catch (final RuntimeException ex) {
!                     throw new RuntimeException("VertexBufferObject: One or both buffers did not become generated!\n" + ex);
!                 }
!                 break;
              }
          }
!         this.mVertexBuffer = array[0];
!         this.mIndexBuffer = array[1];
          GLES20.glBindBuffer(34962, this.mVertexBuffer);
!         GLES20.glBufferData(34962, meshPrimitive.getVertexBufferSize(), (Buffer)meshPrimitive.getVertexBuffer(), 35044);
          GLES20.glBindBuffer(34963, this.mIndexBuffer);
!         GLES20.glBufferData(34963, meshPrimitive.getIndexBufferSize(), (Buffer)meshPrimitive.getIndexBuffer(), 35044);
          FlowRenderer.checkGlError("VertexBufferObject glBufferData");
--- 18,41 ----
      public VertexBufferObject(final MeshPrimitive meshPrimitive) {
!         if (meshPrimitive.isTextured()) {
              this.mTextureBuffer = meshPrimitive.getTextureBuffer();
!         } else {
!             this.mTextureBuffer = null;
!         }
!         this.mIndexSize = meshPrimitive.getNumIndices();
!         int[] buffers = {-1, -1};
!         GLES20.glGenBuffers(2, buffers, 0);
!         if (buffers[0] < 0 || buffers[1] < 0) {
!             try {
!                 FlowRenderer.checkGlError("VertexBufferObject glGenBuffers");
!                 return;
!             } catch (RuntimeException e) {
!                 throw new RuntimeException("VertexBufferObject: One or both buffers did not become generated!\n" + e);
              }
          }
!         this.mVertexBuffer = buffers[0];
!         this.mIndexBuffer = buffers[1];
          GLES20.glBindBuffer(34962, this.mVertexBuffer);
!         GLES20.glBufferData(34962, meshPrimitive.getVertexBufferSize(), meshPrimitive.getVertexBuffer(), 35044);
          GLES20.glBindBuffer(34963, this.mIndexBuffer);
!         GLES20.glBufferData(34963, meshPrimitive.getIndexBufferSize(), meshPrimitive.getIndexBuffer(), 35044);
          FlowRenderer.checkGlError("VertexBufferObject glBufferData");
diff '--context=1' --strip-trailing-cr -r app/src/main/res/raw/background_vertex.glsl new/src/main/res/raw/background_vertex.glsl
*** app/src/main/res/raw/background_vertex.glsl	Mon May  6 12:39:51 2024
--- new/src/main/res/raw/background_vertex.glsl	Mon May  6 12:38:38 2024
***************
*** 19,24 ****
  
! float u_Time = u_Time_HeightScale_Color_XOffset.x;
! float u_HeightScale = u_Time_HeightScale_Color_XOffset.y;
! float u_XOffset = u_Time_HeightScale_Color_XOffset.w;
! float u_ColorIndex = u_Time_HeightScale_Color_XOffset.z;
  
--- 19,24 ----
  
! float u_Time;
! float u_HeightScale;
! float u_XOffset;
! float u_ColorIndex;
  
***************
*** 30,31 ****
--- 30,35 ----
  void main(){
+     u_Time = u_Time_HeightScale_Color_XOffset.x;
+     u_HeightScale = u_Time_HeightScale_Color_XOffset.y;
+     u_XOffset = u_Time_HeightScale_Color_XOffset.w;
+     u_ColorIndex = u_Time_HeightScale_Color_XOffset.z;
      gl_Position = vec4(1.0, u_HeightScale, 1.0, 1.0) * (vPosition + vec4(0.0, -0.2 * sin(vPosition.y + u_XOffset * 2.0 + u_Time + vPosition.x), 0.0, 0.0));
diff '--context=1' --strip-trailing-cr -r app/src/main/res/raw/flow_vertex.glsl new/src/main/res/raw/flow_vertex.glsl
*** app/src/main/res/raw/flow_vertex.glsl	Mon May  6 12:39:51 2024
--- new/src/main/res/raw/flow_vertex.glsl	Mon May  6 12:38:38 2024
***************
*** 5,8 ****
  uniform vec3 u_Time_NoiseScale_Color;
! float u_NoiseScale = u_Time_NoiseScale_Color.y;
! float u_Time = u_Time_NoiseScale_Color.x;
  
--- 5,8 ----
  uniform vec3 u_Time_NoiseScale_Color;
! float u_NoiseScale;
! float u_Time;
  
***************
*** 15,17 ****
  // ----------------------------------------------------------------------
! float uColorTime = u_Time_NoiseScale_Color.x;
  
--- 15,17 ----
  // ----------------------------------------------------------------------
! //float uColorTime = u_Time_NoiseScale_Color.x;
  
***************
*** 98,99 ****
--- 98,101 ----
  void main() {
+     u_NoiseScale = u_Time_NoiseScale_Color.y;
+     u_Time = u_Time_NoiseScale_Color.x;
      gl_Position = uMVPMatrix * addNoise0(aPosition) * NOISE_SCALE;
diff '--context=1' --strip-trailing-cr -r app/src/main/res/values/colors.xml new/src/main/res/values/colors.xml
*** app/src/main/res/values/colors.xml	Mon May  6 12:39:51 2024
--- new/src/main/res/values/colors.xml	Mon May  6 12:38:38 2024
***************
*** 10,11 ****
--- 10,13 ----
      <color name="accent_color_amber">#ffff9900</color>
+ 	<color name="accent">#99cc00</color>
+ 	<color name="primary">#669900</color>
  </resources>
diff '--context=1' --strip-trailing-cr -r app/src/main/res/values/strings.xml new/src/main/res/values/strings.xml
*** app/src/main/res/values/strings.xml	Mon May  6 12:39:51 2024
--- new/src/main/res/values/strings.xml	Mon May  6 12:38:38 2024
***************
*** 5,6 ****
--- 5,19 ----
      <string name="cosmic_flow_app_name">Cosmic Flow</string>
+     <string name="settings">Settings</string>
+     <string name="applyLWP">Apply</string>
+     <string name="lwpDesc">Rotating colorful waves</string>
+     <string name="customColorsName">Custom colors</string>
+     <string name="autoDarkModeName">Auto Dark Mode</string>
+     <string name="isDarkName">Dark Mode</string>
+     <string name="waveStyleName">Wave Style</string>
+     <string name="waveStyleDescName">Choose wave style from predefined presets</string>
+     <string name="customPrimaryColorName">Primary Color</string>
+     <string name="customColorDescName">Put your favourite color HEX</string>
+     <string name="customAccentColorName">Accent Color</string>
+     <string name="bloomDisableName">Disable Bloom</string>
+     <string name="bloomDisableDescName">Disable that thing on background</string>
  </resources>
